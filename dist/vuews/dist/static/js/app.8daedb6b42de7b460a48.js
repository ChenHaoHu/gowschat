webpackJsonp([1],{"09yM":function(t,e){},LQtU:function(t,e){},LiST:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("kV13"),i=s("TcQY"),o=s.n(i),l=(s("09yM"),s("3cXf")),r=s.n(l),n={name:"chat",props:["uid","gid","name"],data:function(){return{p2p:0,islink:!1,socket:"",chatlist:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"}],selectChat:"",chatmsg:"",chatrecord:[]}},computed:{wsuri:function(){return console.log("ws://"+location.hostname+":"+location.port+"/ws/"+this.uid+","+this.name+","+this.gid),"ws://"+location.hostname+":"+location.port+"/ws/"+this.uid+","+this.name+","+this.gid}},methods:{out:function(){this.socket.close()},link:function(t){"undefined"==typeof WebSocket?alert("您的浏览器不支持socket"):(""!=this.socket&&this.socket.close(),this.socket=new WebSocket(this.wsuri),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onclose=this.close,this.socket.onmessage=this.getMessage)},open:function(){console.log("socket连接成功"),this.islink=!0,this.$message({showClose:!0,message:this.wsuri+"socket连接成功",type:"success"})},error:function(){this.islink=!1,this.$message({showClose:!0,message:this.wsuri+"连接失败",type:"error"})},getMessage:function(t){console.log(t.data);var e=JSON.parse(t.data);this.chatrecord.unshift({from:e.Uid,to:e.ToUid,msg:e.Msg,type:"that"})},send:function(){if(1==this.islink){if(this.chatrecord.unshift({from:this.uid,to:this.selectChat,msg:this.chatmsg,type:"this"}),1==this.p2p)var t={touid:this.selectChat,msg:this.chatmsg,sendtype:0};else t={touid:this.selectChat,msg:this.chatmsg,sendtype:1};this.socket.send(r()(t))}else this.$message({showClose:!0,message:"请先连接",type:"error"})},close:function(){this.islink=!1,console.log("socket已经关闭"),this.$message({showClose:!0,message:this.wsuri+"连接关闭",type:"error"})}},destroyed:function(){this.islink=!1,this.socket.onclose=this.close}},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",[s("el-row",{attrs:{gutter:20,type:"flex",justify:"center"}},[s("el-form",{staticStyle:{display:"flex","justify-content":"center",width:"100%"}},[s("el-col",{attrs:{span:5}},[s("el-form-item",{attrs:{label:"UID"}},[s("el-input",{attrs:{clearable:""},model:{value:t.uid,callback:function(e){t.uid=e},expression:"uid"}})],1)],1),t._v(" "),s("el-col",{attrs:{span:5}},[s("el-form-item",{attrs:{label:"Name"}},[s("el-input",{attrs:{clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1)],1),t._v(" "),s("el-col",{attrs:{span:5}},[s("el-form-item",{attrs:{label:"Gid"}},[s("el-input",{attrs:{clearable:""},model:{value:t.gid,callback:function(e){t.gid=e},expression:"gid"}})],1)],1),t._v(" "),s("el-col",{attrs:{span:4}},[s("el-form-item",{attrs:{label:"LINK"}},[s("el-button",{attrs:{type:"primary"},on:{click:t.link}},[t._v("Link")])],1)],1),t._v(" "),s("el-col",{attrs:{span:4}},[s("el-form-item",{attrs:{label:"CLOSE"}},[s("el-button",{attrs:{type:"primary"},on:{click:t.out}},[t._v("OUT")])],1)],1)],1)],1)],1),t._v(" "),s("el-card",{staticClass:"box-card",staticStyle:{height:"400px","overflow-y":"auto"}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[t._v("聊天窗口 ")]),t._v(" "),t.islink?s("el-tag",{attrs:{type:"success"}},[t._v("连接")]):s("el-tag",{attrs:{type:"danger"}},[t._v("未连接")]),t._v(" "),s("br"),t._v(" "),s("span",[t._v("uid: "+t._s(t.uid)+" / name: "+t._s(t.name)+" / gid: "+t._s(t.gid)+" ")])],1),t._v(" "),t._l(t.chatrecord,function(e){return s("div",{staticClass:"text item",staticStyle:{"text-align":"left","font-size":"20px","font-weight":"600"}},["this"==e.type?s("div",[s("el-alert",{attrs:{title:"发送信息给"+e.to,type:"success",closable:!1}},[t._v(t._s(e.msg)+"\n        ")])],1):t._e(),t._v(" "),"NOTICE"==e.from&&"that"==e.type?s("div",[s("el-alert",{attrs:{title:"NOTICE发送信息给"+e.to,type:"error",closable:!1}},[t._v(t._s(e.msg)+"\n        ")])],1):t._e(),t._v(" "),"NOTICE"!=e.from&&"that"==e.type?s("div",[s("el-alert",{attrs:{title:"接收来自"+e.from+"的信息",type:"warning",closable:!1}},[t._v(t._s(e.msg)+"\n        ")])],1):t._e()])})],2),t._v(" "),s("br"),t._v(" "),s("el-switch",{attrs:{"active-text":"单聊","inactive-text":"群发"},model:{value:t.p2p,callback:function(e){t.p2p=e},expression:"p2p"}}),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("div",[s("el-row",{attrs:{gutter:20,type:"flex",justify:"center"}},[1==t.p2p?s("el-col",{attrs:{span:6}},[s("el-input",{attrs:{placeholder:"张三？",clearable:""},model:{value:t.selectChat,callback:function(e){t.selectChat=e},expression:"selectChat"}})],1):t._e(),t._v(" "),s("el-col",{attrs:{span:12}},[s("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:t.chatmsg,callback:function(e){t.chatmsg=e},expression:"chatmsg"}})],1),t._v(" "),s("el-col",{attrs:{span:3}},[s("el-button",{attrs:{type:"primary"},on:{click:t.send}},[t._v("发送")])],1)],1)],1)],1)},staticRenderFns:[]};var u=s("C7Lr")(n,c,!1,function(t){s("LiST")},"data-v-4a3afb2d",null).exports,p=s("I29D"),m=s.n(p),d={name:"App",data:function(){return{dialogFormVisible:!1,form:{type:"2"}}},components:{chat:u},methods:{sendNotice:function(){this.dialogFormVisible=!1;var t=new FormData;t.append("sendtype",parseInt(this.form.type)),t.append("msg",this.form.msg),t.append("gid",this.form.gid),t.append("uid",this.form.uid),m.a.post("/chat/notice",t).then(function(t){this.$message({showClose:!0,message:"发送成功",type:"success"})}).catch(function(t){this.$message({showClose:!0,message:"发送出错",type:"error"})})}}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("el-row",{attrs:{gutter:20,type:"flex",justify:"center"}},[s("el-col",{attrs:{span:9}},[s("chat",{attrs:{uid:100,gid:100,name:111}})],1),t._v(" "),s("el-col",{attrs:{span:9}},[s("chat",{attrs:{uid:101,gid:101,name:222}})],1),t._v(" "),s("el-col",{attrs:{span:9}},[s("chat",{attrs:{uid:102,gid:100,name:333}})],1)],1),t._v(" "),s("br"),t._v(" "),s("br"),t._v(" "),s("el-button",{attrs:{type:"danger"},on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("发送全局通知")]),t._v(" "),s("el-dialog",{attrs:{title:"全局通知",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[s("el-form",{attrs:{model:t.form}},[s("el-form-item",{attrs:{label:"发送内容"}},[s("el-input",{attrs:{"auto-complete":"off"},model:{value:t.form.msg,callback:function(e){t.$set(t.form,"msg",e)},expression:"form.msg"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"发送类型"}},[s("el-select",{attrs:{placeholder:"请选择活动区域"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[s("el-option",{attrs:{label:"应用内全局通知",value:"3"}}),t._v(" "),s("el-option",{attrs:{label:"群内全局通知",value:"2"}}),t._v(" "),s("el-option",{attrs:{label:"群内单点通知",value:"4"}})],1)],1),t._v(" "),4==t.form.type?s("el-form-item",{attrs:{label:"Uid"}},[s("el-input",{model:{value:t.form.uid,callback:function(e){t.$set(t.form,"uid",e)},expression:"form.uid"}})],1):t._e(),t._v(" "),3!=t.form.type?s("el-form-item",{attrs:{label:"Gid"}},[s("el-input",{model:{value:t.form.gid,callback:function(e){t.$set(t.form,"gid",e)},expression:"form.gid"}})],1):t._e()],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.sendNotice}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var f=s("C7Lr")(d,h,!1,function(t){s("LQtU")},null,null).exports;a.default.use(o.a),new a.default({el:"#app",render:function(t){return t(f)}})}},["NHnr"]);
//# sourceMappingURL=app.8daedb6b42de7b460a48.js.map